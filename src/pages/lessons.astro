---
import Layout from "../layouts/Layout.astro";
import UrlStateWrapper from "../components/UrlStateWrapper.astro";
import LessonsApp from "../components/lessons/LessonsApp";
import { 
  loadPlaylistsWithVideos, 
  loadChannelVideos,
  categories, 
  channelInfo 
} from "../lib/videoLoader";

// Load all data using the centralized loader
const [playlistsWithVideos, channelVideos] = await Promise.all([
  loadPlaylistsWithVideos(),
  loadChannelVideos(),
]);

const totalVideos = playlistsWithVideos.reduce((acc, p) => acc + p.videos.length, 0) + channelVideos.length;
const totalPlaylists = playlistsWithVideos.length;
const totalCategories = categories.filter(c => playlistsWithVideos.some(p => p.category === c)).length;
---

<Layout title="ุงูููุชุจุฉ ุงููุฑุฆูุฉ | ุงูุฏุฑูุณ ูุงููุญุงุถุฑุงุช">
  <UrlStateWrapper skeletonId="lessons-skeleton" contentId="lessons-app">
    <!-- Skeleton slot -->
    <div slot="skeleton" class="min-h-screen bg-emerald-950 text-emerald-50">
      <header class="bg-gradient-to-b from-emerald-900 to-emerald-950 pt-24 pb-8">
        <div class="container mx-auto px-4">
          <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-400 mb-4 font-cairo">๐ ุงูููุชุจุฉ ุงููุฑุฆูุฉ</h1>
            <p class="text-emerald-200 text-lg max-w-2xl mx-auto">{channelInfo.description}</p>
          </div>
          <div class="grid grid-cols-3 gap-4 max-w-lg mx-auto mb-8">
            <div class="bg-emerald-800/50 rounded-xl p-4 text-center backdrop-blur-sm border border-emerald-700/50">
              <div class="text-2xl font-bold text-amber-400">{totalVideos}</div>
              <div class="text-sm text-emerald-300">ููุฏูู</div>
            </div>
            <div class="bg-emerald-800/50 rounded-xl p-4 text-center backdrop-blur-sm border border-emerald-700/50">
              <div class="text-2xl font-bold text-amber-400">{totalPlaylists}</div>
              <div class="text-sm text-emerald-300">ูุงุฆูุฉ ุชุดุบูู</div>
            </div>
            <div class="bg-emerald-800/50 rounded-xl p-4 text-center backdrop-blur-sm border border-emerald-700/50">
              <div class="text-2xl font-bold text-amber-400">{totalCategories}</div>
              <div class="text-sm text-emerald-300">ุชุตููู</div>
            </div>
          </div>
          <div class="max-w-2xl mx-auto">
            <div class="w-full h-14 bg-emerald-800/70 border border-emerald-600 rounded-2xl animate-pulse"></div>
          </div>
        </div>
      </header>
      <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col lg:flex-row gap-8">
          <aside class="lg:w-80 shrink-0 order-2 lg:order-1">
            <div class="bg-emerald-900/50 rounded-2xl border border-emerald-700/50 p-4">
              <div class="h-6 bg-emerald-800 rounded w-1/2 mb-4 animate-pulse"></div>
              <div class="space-y-2">
                <div class="h-10 bg-emerald-800 rounded animate-pulse"></div>
                <div class="h-10 bg-emerald-800 rounded animate-pulse"></div>
                <div class="h-10 bg-emerald-800 rounded animate-pulse"></div>
              </div>
            </div>
          </aside>
          <div class="flex-1 order-1 lg:order-2">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {[1,2,3,4,5,6].map(() => (
                <div class="bg-emerald-900/50 rounded-xl overflow-hidden border border-emerald-700/50">
                  <div class="aspect-video bg-emerald-800 animate-pulse"></div>
                  <div class="p-4 space-y-2">
                    <div class="h-4 bg-emerald-800 rounded w-3/4 animate-pulse"></div>
                    <div class="h-4 bg-emerald-800 rounded w-1/2 animate-pulse"></div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Main app (default slot) -->
    <LessonsApp 
      client:load
      playlists={playlistsWithVideos}
      channelVideos={channelVideos}
      channelInfo={channelInfo}
      categories={categories}
    />
  </UrlStateWrapper>
</Layout>
